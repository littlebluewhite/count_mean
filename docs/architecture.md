# 系統架構文檔

## 整體架構

EMG 數據分析工具採用模組化設計，將功能分離為獨立的套件，便於維護和擴展。

## 核心模組

### 1. 主程序 (main.go)
- 應用程序入口點
- 命令行參數處理
- GUI/CLI 模式選擇

### 2. GUI 模組 (gui/)
- **app.go**: Fyne 應用程序主體
- **components/**: UI 組件庫
- 負責用戶界面和交互邏輯

### 3. 計算引擎 (internal/calculator)
- **MaxMeanCalculator**: 核心計算類
- **算法實現**: 高效的數學運算
- **數據處理**: 支持各種數據格式

### 4. CSV 處理 (internal/csv)
- **CSVHandler**: CSV 文件讀寫
- **數據驗證**: 輸入數據格式檢查
- **錯誤處理**: 完善的異常處理機制

### 5. 配置管理 (internal/config)
- **AppConfig**: 應用程序配置結構
- **配置載入**: JSON 配置文件處理
- **默認設定**: 合理的默認值

### 6. 日誌系統 (internal/logging)
- **結構化日誌**: JSON 格式日誌輸出
- **多級別**: Debug, Info, Warn, Error
- **文件輪轉**: 自動日誌文件管理

### 7. 國際化 (internal/i18n)
- **多語言支持**: zh-TW, zh-CN, en-US
- **動態切換**: 運行時語言切換
- **本地化**: 日期、數字格式本地化

### 8. 輸入驗證 (internal/validator)
- **路徑驗證**: 防止目錄遍歷攻擊
- **數據清理**: 輸入數據淨化
- **安全檢查**: 多層安全驗證

### 9. 性能測試 (internal/benchmark)
- **Benchmarker**: 性能測試框架
- **CSVBenchmarks**: CSV 處理性能測試
- **報告生成**: 詳細的性能報告

## 數據流程

`
用戶輸入 -> 輸入驗證 -> CSV處理 -> 計算引擎 -> 結果輸出
    |          |           |          |           |
    v          v           v          v           v
  GUI/CLI -> Validator -> CSVHandler -> Calculator -> 文件/界面
`

## 安全機制

### 1. 輸入驗證
- 路徑規範化和驗證
- 文件類型檢查
- 數據格式驗證

### 2. 錯誤處理
- 分層錯誤處理
- 詳細錯誤日誌
- 優雅的錯誤恢復

### 3. 資源管理
- 自動資源清理
- 記憶體使用監控
- 文件句柄管理

## 性能優化

### 1. 算法優化
- 高效的數學運算
- 批量數據處理
- 記憶體友好的數據結構

### 2. 並發處理
- Goroutine 池管理
- Channel 通信
- 同步機制

### 3. 緩存策略
- 計算結果緩存
- 配置文件緩存
- 智能預載入

## 擴展性設計

### 1. 插件架構
- 介面導向設計
- 鬆耦合組件
- 動態載入機制

### 2. 配置驅動
- 外部配置文件
- 運行時參數調整
- 環境適應性

### 3. 模組化
- 獨立功能模組
- 清晰的依賴關係
- 易於測試和維護
